import { removeOldCompletedRecords } from '../../src/utils';

test('should remove old completed member tracking records', () => {
  const userResponse = JSON.parse(
    `{"isActive":true,"userId":"1927e677-6d12-46cf-b1b0-53976bbeab46","createdAt":"2021-09-13T23:35:11.269Z","trackingItemId":1,"trackingItem":{"id":1,"title":"Fire Extinguisher","description":"This is a AF yearly requirment","interval":365},"memberTrackingRecords":[{"id":12,"traineeSignedDate":"2021-09-13T23:52:36.663Z","authoritySignedDate":"2021-09-13T23:52:50.762Z","authorityId":"a9bfe746-744a-4315-a265-9ce6a6c27c38","createdAt":"2021-09-13T23:52:33.306Z","completedDate":"2021-10-28T10:00:00.000Z","order":4,"traineeId":"1927e677-6d12-46cf-b1b0-53976bbeab46","trackingItemId":1,"authority":{"id":"a9bfe746-744a-4315-a265-9ce6a6c27c38","dodId":"2223332221","firstName":"Joe","lastName":"Smith","middleName":null,"email":"Nasir.Mayert87@yahoo.com","createdAt":"2021-09-13T23:34:25.660Z","updatedAt":"2021-09-13T23:52:58.201Z","lastLogin":"2021-09-13T23:52:58.186Z","roleId":1,"organizationId":"7e4e43ac-f1f7-4f20-adf6-3c98e5848c25","rank":"SSgt/E5","afsc":"5P7X1","dutyTitle":"24/7 bandwidth orchestrate","address":"15 WG/WSA Tron, Bldg 1102"},"trackingItem":{"id":1,"title":"Fire Extinguisher","description":"This is a AF yearly requirment","interval":365}},{"id":11,"traineeSignedDate":"2021-09-13T23:52:12.928Z","authoritySignedDate":"2021-09-13T23:36:34.669Z","authorityId":"a9bfe746-744a-4315-a265-9ce6a6c27c38","createdAt":"2021-09-13T23:36:34.119Z","completedDate":"2021-10-01T10:00:00.000Z","order":3,"traineeId":"1927e677-6d12-46cf-b1b0-53976bbeab46","trackingItemId":1,"authority":{"id":"a9bfe746-744a-4315-a265-9ce6a6c27c38","dodId":"2223332221","firstName":"Joe","lastName":"Smith","middleName":null,"email":"Nasir.Mayert87@yahoo.com","createdAt":"2021-09-13T23:34:25.660Z","updatedAt":"2021-09-13T23:52:58.201Z","lastLogin":"2021-09-13T23:52:58.186Z","roleId":1,"organizationId":"7e4e43ac-f1f7-4f20-adf6-3c98e5848c25","rank":"SSgt/E5","afsc":"5P7X1","dutyTitle":"24/7 bandwidth orchestrate","address":"15 WG/WSA Tron, Bldg 1102"},"trackingItem":{"id":1,"title":"Fire Extinguisher","description":"This is a AF yearly requirment","interval":365}},{"id":9,"traineeSignedDate":"2021-09-13T23:36:01.476Z","authoritySignedDate":"2021-09-13T23:35:54.189Z","authorityId":"a9bfe746-744a-4315-a265-9ce6a6c27c38","createdAt":"2021-09-13T23:35:53.649Z","completedDate":"2021-10-01T10:00:00.000Z","order":2,"traineeId":"1927e677-6d12-46cf-b1b0-53976bbeab46","trackingItemId":1,"authority":{"id":"a9bfe746-744a-4315-a265-9ce6a6c27c38","dodId":"2223332221","firstName":"Joe","lastName":"Smith","middleName":null,"email":"Nasir.Mayert87@yahoo.com","createdAt":"2021-09-13T23:34:25.660Z","updatedAt":"2021-09-13T23:52:58.201Z","lastLogin":"2021-09-13T23:52:58.186Z","roleId":1,"organizationId":"7e4e43ac-f1f7-4f20-adf6-3c98e5848c25","rank":"SSgt/E5","afsc":"5P7X1","dutyTitle":"24/7 bandwidth orchestrate","address":"15 WG/WSA Tron, Bldg 1102"},"trackingItem":{"id":1,"title":"Fire Extinguisher","description":"This is a AF yearly requirment","interval":365}},{"id":7,"traineeSignedDate":"2021-09-13T23:35:19.813Z","authoritySignedDate":"2021-09-13T23:35:12.029Z","authorityId":"a9bfe746-744a-4315-a265-9ce6a6c27c38","createdAt":"2021-09-13T23:35:11.290Z","completedDate":"2021-09-01T10:00:00.000Z","order":1,"traineeId":"1927e677-6d12-46cf-b1b0-53976bbeab46","trackingItemId":1,"authority":{"id":"a9bfe746-744a-4315-a265-9ce6a6c27c38","dodId":"2223332221","firstName":"Joe","lastName":"Smith","middleName":null,"email":"Nasir.Mayert87@yahoo.com","createdAt":"2021-09-13T23:34:25.660Z","updatedAt":"2021-09-13T23:52:58.201Z","lastLogin":"2021-09-13T23:52:58.186Z","roleId":1,"organizationId":"7e4e43ac-f1f7-4f20-adf6-3c98e5848c25","rank":"SSgt/E5","afsc":"5P7X1","dutyTitle":"24/7 bandwidth orchestrate","address":"15 WG/WSA Tron, Bldg 1102"},"trackingItem":{"id":1,"title":"Fire Extinguisher","description":"This is a AF yearly requirment","interval":365}}]}`
  );
  const memberTrackingRecords = userResponse.memberTrackingRecords;

  expect(memberTrackingRecords.length).toBe(4);

  const results = removeOldCompletedRecords(memberTrackingRecords);

  expect(results.length).toBe(1);
  const latestRecord = results.filter((result) => result.traineeSignedDate !== null)[0];
  expect(latestRecord.completedDate).toBe('2021-10-28T10:00:00.000Z');
});
